function t(t){return t&&t.__esModule?t.default:t}var e={};class s{static STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};static DIRECTION={left:"left",right:"right",up:"up",down:"down"};static INITIAL_STATE=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];static WIN_COUNT=2048;constructor(t=s.INITIAL_STATE){this.initialState=t,this.state=JSON.parse(JSON.stringify(this.initialState)),this.score=0,this.status=s.STATUS.idle,this.gameSize=t.length}moveLeft(){this.move(s.DIRECTION.left)}moveRight(){this.move(s.DIRECTION.right)}moveUp(){this.move(s.DIRECTION.up)}moveDown(){this.move(s.DIRECTION.down)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=s.STATUS.playing,this.addTile(),this.addTile()}restart(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.score=0,this.status=s.STATUS.idle}move(t){let e;this.getStatus()===s.STATUS.playing&&(t===s.DIRECTION.left&&(e=this.state.map(t=>this.updateRow(t))),t===s.DIRECTION.right&&(e=this.reverseRows(this.reverseRows(this.state).map(t=>this.updateRow(t)))),t===s.DIRECTION.up&&(e=this.columnsToRows(this.columnsToRows(this.state).map(t=>this.updateRow(t)))),t===s.DIRECTION.down&&(e=this.columnsToRows(this.reverseRows(this.reverseRows(this.columnsToRows(this.state)).map(t=>this.updateRow(t))))),this.shouldMove(this.state,e)&&(this.state=e,this.addTile()),this.updateGameStatus())}getEmptyCells(){return this.state.reduce((t,e,s)=>(e.forEach((e,i)=>{e||t.push({rowIndex:s,colIndex:i})}),t),[])}addTile(){let t=this.getEmptyCells();if(t.length){let e=Math.floor(Math.random()*t.length),{rowIndex:s,colIndex:i}=t[e];this.state[s][i]=.1>=Math.random()?4:2}}columnsToRows(t){return t.reduce((t,e)=>(e.forEach((e,s)=>{t[s]||(t[s]=[]),t[s].push(e)}),t),[])}reverseRows(t){return t.map(t=>[...t].reverse())}updateRow(t){let e=t.filter(t=>t);for(let t=0;t<e.length-1;t++){let s=e[t];if(s===e[t+1]){let i=2*s;e[t]=i,e.splice(t+1,1),this.score+=i}}for(;e.length<this.gameSize;)e.push(0);return e}canMoveRow(t){return t.some((e,s)=>e===t[s+1])}shouldMove(t,e){return e.some((e,s)=>e.some((e,i)=>e!==t[s][i]))}canMove(){return this.state.some(t=>this.canMoveRow(t))||this.columnsToRows(this.state).some(t=>this.canMoveRow(t))}updateGameStatus(){this.state.some(t=>t.includes(s.WIN_COUNT))&&(this.status=s.STATUS.win),this.canMove()||(this.status=s.STATUS.lose)}}const i=new(t(e=s)),o=document.querySelector(".button"),a=document.querySelector("tbody"),r=document.querySelector(".message-start"),n=document.querySelector(".message-lose"),l=document.querySelector(".message-win"),h=document.querySelector(".game-score");function c(){document.removeEventListener("keydown",d)}function d(s){switch(s.preventDefault(),s.key){case"ArrowLeft":i.moveLeft();break;case"ArrowRight":i.moveRight();break;case"ArrowUp":i.moveUp();break;case"ArrowDown":i.moveDown()}u(),[t(e).STATUS.win,t(e).STATUS.lose].includes(i.getStatus())&&(c(),m())}function u(){i.state.forEach((t,e)=>{let s=document.createElement("tr");s.classList.add("field-row"),t.forEach(t=>{let e=document.createElement("td");e.classList.add("field-cell"),t&&e.classList.add(`field-cell--${t}`),e.textContent=t||"",s.appendChild(e)}),a.replaceChild(s,a.rows[e])}),h.textContent=i.getScore().toString()}function m(){switch(i.getStatus()){case t(e).STATUS.idle:r.classList.remove("hidden"),l.classList.add("hidden"),n.classList.add("hidden");break;case t(e).STATUS.playing:r.classList.add("hidden");break;case t(e).STATUS.win:l.classList.remove("hidden");break;case t(e).STATUS.lose:n.classList.remove("hidden")}}o.addEventListener("click",function(){i.getStatus()===t(e).STATUS.idle?(document.addEventListener("keydown",d),o.textContent="Restart",i.start()):(o.textContent="Start",i.restart(),c()),o.classList.toggle("restart"),o.classList.toggle("start"),u(),m()});
//# sourceMappingURL=index.8dbf3569.js.map
